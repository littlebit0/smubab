<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 50px auto;
            padding: 20px;
        }

        button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        #result {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }

        .menu-card {
            margin: 10px 0;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            background: white;
        }

        .restaurant {
            font-weight: bold;
            color: #333;
        }

        .meal-type {
            color: #666;
            font-size: 14px;
        }

        .item {
            margin: 5px 0;
            padding-left: 20px;
        }
    </style>
</head>

<body>
    <h1>ğŸš SMU-Bab API í…ŒìŠ¤íŠ¸</h1>

    <div>
        <button onclick="testTodayMenu()">ì˜¤ëŠ˜ ë©”ë‰´ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testWeekMenu()">ì£¼ê°„ ë©”ë‰´ í…ŒìŠ¤íŠ¸</button>
        <button onclick="testHealth()">í—¬ìŠ¤ ì²´í¬</button>
    </div>

    <div id="result"></div>

    <script>
        const API_URL = 'http://localhost:8000';

        async function testHealth() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>â³ í—¬ìŠ¤ ì²´í¬ ì¤‘...</p>';

            try {
                const response = await fetch(`${API_URL}/api/health`);
                const data = await response.json();
                resultDiv.innerHTML = `
                    <h3>âœ… í—¬ìŠ¤ ì²´í¬ ì„±ê³µ</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3>âŒ ì˜¤ë¥˜ ë°œìƒ</h3>
                    <p>${error.message}</p>
                `;
            }
        }

        async function testTodayMenu() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>â³ ì˜¤ëŠ˜ ë©”ë‰´ ë¡œë”© ì¤‘...</p>';

            try {
                const response = await fetch(`${API_URL}/api/menus/today`);
                const data = await response.json();

                console.log('ğŸ“¥ ì‘ë‹µ ë°ì´í„°:', data);

                let html = `
                    <h3>âœ… ì˜¤ëŠ˜ ë©”ë‰´ (${data.date})</h3>
                    <p>ì´ ${data.menus.length}ê°œ ë©”ë‰´</p>
                `;

                data.menus.forEach(menu => {
                    html += `
                        <div class="menu-card">
                            <div>
                                <span class="restaurant">${menu.restaurant}</span>
                                <span class="meal-type"> - ${menu.meal_type}</span>
                            </div>
                            <div class="items">
                                ${menu.items.map(item => `
                                    <div class="item">â€¢ ${item.name}${item.price ? ' (' + item.price + 'ì›)' : ''}</div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                });

                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3>âŒ ì˜¤ë¥˜ ë°œìƒ</h3>
                    <p>${error.message}</p>
                    <p>ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš” (F12)</p>
                `;
                console.error('Error:', error);
            }
        }

        async function testWeekMenu() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>â³ ì£¼ê°„ ë©”ë‰´ ë¡œë”© ì¤‘...</p>';

            try {
                const response = await fetch(`${API_URL}/api/menus/week`);
                const data = await response.json();

                console.log('ğŸ“¥ ì‘ë‹µ ë°ì´í„°:', data);

                // ë‚ ì§œë³„ë¡œ ê·¸ë£¹í™”
                const grouped = {};
                data.data.forEach(menu => {
                    if (!grouped[menu.date]) {
                        grouped[menu.date] = [];
                    }
                    grouped[menu.date].push(menu);
                });

                let html = `
                    <h3>âœ… ì£¼ê°„ ë©”ë‰´</h3>
                    <p>${data.message}</p>
                `;

                Object.keys(grouped).sort().forEach(date => {
                    html += `<h4>${date}</h4>`;
                    grouped[date].forEach(menu => {
                        html += `
                            <div class="menu-card">
                                <div>
                                    <span class="restaurant">${menu.restaurant}</span>
                                    <span class="meal-type"> - ${menu.meal_type}</span>
                                </div>
                                <div class="items">
                                    ${menu.items.map(item => `
                                        <div class="item">â€¢ ${item.name}${item.price ? ' (' + item.price + 'ì›)' : ''}</div>
                                    `).join('')}
                                </div>
                            </div>
                        `;
                    });
                });

                resultDiv.innerHTML = html;
            } catch (error) {
                resultDiv.innerHTML = `
                    <h3>âŒ ì˜¤ë¥˜ ë°œìƒ</h3>
                    <p>${error.message}</p>
                    <p>ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš” (F12)</p>
                `;
                console.error('Error:', error);
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ í…ŒìŠ¤íŠ¸
        window.onload = () => {
            console.log('ğŸš€ í˜ì´ì§€ ë¡œë“œë¨');
            testTodayMenu();
        };
    </script>
</body>

</html>